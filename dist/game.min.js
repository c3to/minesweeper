Array.prototype.inArray=function e(t){for(var n=0;n<this.length;n++){if(this[n]===t){return true}}return false};if(Array.prototype.equals)console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.equals=function(e){if(!e)return false;if(this.length!=e.length)return false;for(var t=0,n=this.length;t<n;t++){if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return false}else if(this[t]!=e[t]){return false}}return true};if(Array.prototype.contains)console.warn("Overriding existing Array.prototype.contains. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.contains=function(e){if(!this)return false;var t=false;for(var n=0,r=this.length;n<r;n++){if(this[n]instanceof Array){if(this[n].equals(e))t=true}else if(this[n]===e)t=true}return t};Array.prototype.indexOf=function(e){if(!this)return-1;var t=-1;for(var n=0,r=this.length;n<r;n++){if(this[n]instanceof Array)if(this[n].equals(e))t=n;else if(this[n]===e)t=n}return t};function Tile(e,t){this.x=e;this.y=t;this.danger=0;this.bomb=false;this.flag=false;this.revealed=false;var n=document.createElement("div");n.className="btn btn-tile";n.addEventListener("click",this,false);var r=document.createElement("span");r.innerHTML="";this.icon=r;this.btn=n;this.btn.appendChild(this.icon);this.addEvents()}Tile.prototype.addEvents=function(){this.btn.addEventListener("click",this)};Tile.prototype.removeEvents=function(){this.btn.removeEventListener("click",this)};Tile.prototype.handleEvent=function(e){switch(e.type){case"click":game.click(this)}};Tile.prototype.setBomb=function(){this.bomb=true};Tile.prototype.addDanger=function(){this.danger++};Tile.prototype.toggleFlag=function(){this.flag=!this.flag;this.btn.classList.toggle("btn-tile");this.btn.classList.toggle("btn-flag-active")};Tile.prototype.render=function(){this.revealed=true;this.removeEvents();if(this.bomb){this.btn.className="btn btn-bomb"}else{this.btn.className="btn btn-revealed";this.icon.className="";this.icon.innerHTML=this.danger}};Tile.prototype.blink=function(){this.btn.classList.add("blinking")};var game=function(){"use strict";var f=[],o=[],l=8,r=8,t,n,a,i,s,c;var e=$("#hud"),h=$("#timer"),d=e.find("#menuBtn"),u=e.find("#flagModeBtn"),v=e.find("#flagCount"),g=$(".reload"),b=$("#board"),p=$("#gameMenu"),m=$("#gameOver"),y=$("#bestTry"),k=$("#lastTry");T();w();function w(){A();N();q(false);n=r;v.html(n);a=0;M();O();s=0;clearInterval(i);i=setInterval(function(){E()},1e3)}function A(){switch(p.find('input[name="level"]:checked').val()){case"0":l=6;r=4;break;case"1":l=8;r=8;break;case"2":l=12;r=16;break;case"3":l=18;r=28;break}}function T(){g.click(w);u.click(q);d.click(function(){p.modal()})}function E(){s++;h.text(s)}function N(){f=[];b.html("");for(var e=0;e<l;e++){var t=[],n=document.createElement("div");n.className="btn-group btn-block";for(var r=0;r<l;r++){var a=new Tile(r,e);t.push(a);n.appendChild(a.btn)}f[e]=t;b.append(n)}}function M(){o=[];var e,t;for(var n=0;n<r;n++){e=Math.round(Math.random()*(l-1));t=Math.round(Math.random()*(l-1));if(!f[t][e].bomb){o.push([e,t]);f[t][e].setBomb()}else n--}}function O(){for(var e=0;e<o.length;e++){var t=o[e][0];var n=o[e][1];var r=C(t,n);for(var a=0;a<r.length;a++){var i=r[a][0];var s=r[a][1];if(!f[s][i].bomb){f[s][i].addDanger()}}}}function C(e,t){var n=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]];var r=[];for(var a=0;a<n.length;a++){var i=e+n[a][0];var s=t+n[a][1];if(s<l&&s>-1&&i<l&&i>-1){r.push([i,s])}}return r}function I(e,t){var n=[[e,t]];var r=n.slice();while(n.length>0){var a=C(n[0][0],n[0][1]);for(var i=0;i<a.length;i++){var s=f[a[i][1]][a[i][0]];if(!r.contains(a[i])){if(!s.flag&&!s.revealed){if(s.danger===0){r.push(a[i]);n.push(a[i])}else{r.push(a[i])}}}}n.shift()}for(var i=0;i<r.length;i++){var o=r[i][0];var l=r[i][1];f[l][o].render()}}function L(){for(var e=0;e<f.length;e++){for(var t=0;t<f[e].length;t++){f[e][t].render()}}}function q(e){if(typeof e==="boolean"){if(e){u.addClass("btn-flag-active");t=e}else{u.removeClass("btn-flag-active");t=e}}else{u.toggleClass("btn-flag-active");t=!t}}function x(e){if(e.flag){e.toggleFlag();++n;a=e.bomb?a-1:a+1}else if(n>0){e.toggleFlag();--n;a=e.bomb?a+1:a-1}v.html(n)}function F(e){m.find(".modal-title").html(messages[e].header);m.find(".modal-body").html(messages[e].body).append(" "+s+" seconds");m.modal()}return{map:function(){return f},click:function(e){if(t){x(e);if(a===r){clearInterval(i);if(typeof c==="undefined"||s<c){L();F("record");c=s;y.html(s+" seconds");k.prepend('<a href="#" class="list-group-item">record: '+s+" seconds</a>")}else{L();F("win");k.prepend('<a href="#" class="list-group-item">won: '+s+" seconds</a>")}}else if(n===0){L();clearInterval(i);F("falseFlag");k.prepend('<a href="#" class="list-group-item">lost: '+s+" seconds</a>")}}else if(!e.revealed&&!e.flag){if(!e.bomb){if(!e.danger>0){I(e.x,e.y)}else{e.render()}}else{clearInterval(i);console.log(e);L();e.blink();F("bomb");k.prepend('<a href="#" class="list-group-item">lost: '+s+" seconds</a>")}}}}}();var messages={win:{header:"WINNER",body:"You did it in"},record:{header:"NEW RECORD",body:"Congratulations that is a new record in"},bomb:{header:"BOOM",body:"That was a bomb after"},falseFlag:{header:"OH NO!",body:"You are running out of Flags after"}};