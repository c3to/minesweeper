Array.prototype.inArray=function e(t){for(var n=0;n<this.length;n++){if(this[n]===t){return true}}return false};if(Array.prototype.equals)console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.equals=function(e){if(!e)return false;if(this.length!=e.length)return false;for(var t=0,n=this.length;t<n;t++){if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return false}else if(this[t]!=e[t]){return false}}return true};if(Array.prototype.contains)console.warn("Overriding existing Array.prototype.contains. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.contains=function(e){if(!this)return false;var t=false;for(var n=0,r=this.length;n<r;n++){if(this[n]instanceof Array){if(this[n].equals(e))t=true}else if(this[n]===e)t=true}return t};Array.prototype.indexOf=function(e){if(!this)return-1;var t=-1;for(var n=0,r=this.length;n<r;n++){if(this[n]instanceof Array)if(this[n].equals(e))t=n;else if(this[n]===e)t=n}return t};function Tile(e,t){this.x=e;this.y=t;this.danger=0;this.bomb=false;this.flag=false;this.revealed=false;var n=document.createElement("div");n.className="btn btn-tile";n.addEventListener("click",this,false);var r=document.createElement("span");r.innerHTML="";this.icon=r;this.btn=n;this.btn.appendChild(this.icon);this.addEvents()}Tile.prototype.addEvents=function(){this.btn.addEventListener("click",this)};Tile.prototype.removeEvents=function(){this.btn.removeEventListener("click",this)};Tile.prototype.handleEvent=function(e){switch(e.type){case"click":game.click(this)}};Tile.prototype.setBomb=function(){this.bomb=true};Tile.prototype.addDanger=function(){this.danger++};Tile.prototype.toggleFlag=function(){this.flag=!this.flag;this.btn.classList.toggle("btn-tile");this.btn.classList.toggle("btn-flag-active")};Tile.prototype.render=function(){this.revealed=true;this.removeEvents();if(this.bomb){this.btn.className="btn btn-bomb"}else{this.btn.className="btn btn-revealed";this.icon.className="";this.icon.innerHTML=this.danger}};Tile.prototype.blink=function(){this.btn.classList.add("blinking")};var game=function(){"use strict";var e=[],t=[],n=8,r=8,a,i,s,o,l,f;var c=$("#hud"),h=$("#timer"),d=c.find("#menuBtn"),u=c.find("#flagModeBtn"),v=c.find("#flagCount"),g=$(".reload"),b=$("#board"),p=$("#gameMenu"),m=$("#gameOver"),y=$("#bestTry"),k=$("#lastTry");T();w();function w(){A();N();q(false);i=r;v.html(i);s=0;M();O();l=0;clearInterval(o);o=setInterval(function(){E()},1e3)}function A(){switch(p.find('input[name="level"]:checked').val()){case"0":n=6;r=4;break;case"1":n=8;r=8;break;case"2":n=12;r=16;break;case"3":n=18;r=28;break}}function T(){g.click(w);u.click(q);d.click(function(){p.modal()})}function E(){l++;h.text(l)}function N(){e=[];b.html("");for(var t=0;t<n;t++){var r=[],a=document.createElement("div");a.className="btn-group btn-block";for(var i=0;i<n;i++){var s=new Tile(i,t);r.push(s);a.appendChild(s.btn)}e[t]=r;b.append(a)}}function M(){t=[];var a,i;for(var s=0;s<r;s++){a=Math.round(Math.random()*(n-1));i=Math.round(Math.random()*(n-1));if(!e[i][a].bomb){t.push([a,i]);e[i][a].setBomb()}else s--}}function O(){for(var n=0;n<t.length;n++){var r=t[n][0];var a=t[n][1];var i=C(r,a);for(var s=0;s<i.length;s++){var o=i[s][0];var l=i[s][1];if(!e[l][o].bomb){e[l][o].addDanger()}}}}function C(e,t){var r=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]];var a=[];for(var i=0;i<r.length;i++){var s=e+r[i][0];var o=t+r[i][1];if(o<n&&o>-1&&s<n&&s>-1){a.push([s,o])}}return a}function I(t,n){var r=[[t,n]];var a=r.slice();while(r.length>0){var i=C(r[0][0],r[0][1]);for(var s=0;s<i.length;s++){var o=e[i[s][1]][i[s][0]];if(!a.contains(i[s])){if(!o.flag&&!o.revealed){if(o.danger===0){a.push(i[s]);r.push(i[s])}else{a.push(i[s])}}}}r.shift()}for(var s=0;s<a.length;s++){var l=a[s][0];var f=a[s][1];e[f][l].render()}}function L(){for(var t=0;t<e.length;t++){for(var n=0;n<e[t].length;n++){e[t][n].render()}}}function q(e){if(typeof e==="boolean"){if(e){u.addClass("btn-flag-active");a=e}else{u.removeClass("btn-flag-active");a=e}}else{u.toggleClass("btn-flag-active");a=!a}}function x(e){if(e.flag){e.toggleFlag();++i;s=e.bomb?s-1:s+1}else if(i>0){e.toggleFlag();--i;s=e.bomb?s+1:s-1}v.html(i)}function F(e){m.find(".modal-title").html(messages[e].header);m.find(".modal-body").html(messages[e].body).append(" "+l+" seconds");m.modal()}return{map:function(){return e},click:function(e){if(a){x(e);if(s===r){clearInterval(o);if(typeof f==="undefined"||l<f){L();F("record");f=l;y.html(l+" seconds");k.prepend('<a href="#" class="list-group-item">record: '+l+" seconds</a>")}else{L();F("win");k.prepend('<a href="#" class="list-group-item">won: '+l+" seconds</a>")}}else if(i===0){L();clearInterval(o);F("falseFlag");k.prepend('<a href="#" class="list-group-item">lost: '+l+" seconds</a>")}}else if(!e.revealed&&!e.flag){if(!e.bomb){if(!e.danger>0){I(e.x,e.y)}else{e.render()}}else{clearInterval(o);console.log(e);L();e.blink();F("bomb");k.prepend('<a href="#" class="list-group-item">lost: '+l+" seconds</a>")}}}}}();var messages={win:{header:"WINNER",body:"You did it in"},record:{header:"NEW RECORD",body:"Congratulations that is a new record in"},bomb:{header:"BOOM",body:"That was a bomb after"},falseFlag:{header:"OH NO!",body:"You are running out of Flags after"}};