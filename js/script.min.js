"use strict";$(document).ready(function(){minesweeper()});var minesweeper=function(){var e,a,n,u,l,t,s,r,o,c=new Array,i=!1,v=$("#app"),f=v.find("#timer"),h=v.find("#neuBtn"),d=v.find("#flagsBtn"),p=v.find("#flags"),_=v.find("#board"),g=_.html(),b=v.find("#gameOver"),m=b.find(".modal-title"),x=b.find(".modal-body"),k=b.find(".modal-footer button"),w=v.find("#bestTry"),y=v.find("#lastTry"),C=v.find("#menuBtn"),N=v.find("#gameMenu"),B=N.find(".modal-footer button");h.click(A),k.click(A),d.click(I),C.click(function(){N.modal()}),B.click(A),A();function A(){c=[],e=10,u=0,l=0,s=0,function(){switch(N.find('input[name="level"]:checked').val()){case"0":a=5;break;case"1":a=10;break;case"2":a=15;break;case"3":a=20;break;default:a=10}}(),n=a,o=0,clearInterval(r),r=setInterval(function(){o++,f.text(o)},1e3),p.text(a),function(){var n=Number,u=function(){n=window.screen.height>window.screen.width?window.screen.width:window.screen.height-200;return(n-20)/e}();(function(){_.empty().css({width:n-20,height:n-20});for(var a=0;a<e;a++){c[a]=new Array;for(var l=0;l<e;l++){var t=$(g).css({width:u,height:u,left:u*l,top:u*a});t.attr("id",a+"_"+l),t.mousedown(E),t.bind("contextmenu",function(e){return!1}),_.append(t);var s=new T;c[a][l]=s}}})(),function(){for(var n,u,l=0;l<a;l++)n=Math.round(Math.random()*(e-1)),u=Math.round(Math.random()*(e-1)),"x"!=c[u][n].value?(c[u][n].value="x",console.log("Bomb"+l+" x:"+n+" y:"+u)):l--}(),function(){for(var a=0;a<e;a++)for(var n=0;n<e;n++)"x"!=c[a][n].value&&(c[a][n].value=M(a,n,"x").length)}()}()}function I(){d.toggleClass("btn-danger"),i=0==i}function M(a,n,u){var l=Number(a),t=Number(n),s=e-1,r=new Array;return 0===l?0===t?(c[l][t+1].value===u&&r.push(l+"_"+(t+1)),c[l+1][t].value===u&&r.push(l+1+"_"+t),c[l+1][t+1].value===u&&r.push(l+1+"_"+(t+1))):t===s?(c[l][t-1].value===u&&r.push(l+"_"+(t-1)),c[l+1][t-1].value===u&&r.push(l+1+"_"+(t-1)),c[l+1][t].value===u&&r.push(l+1+"_"+t)):(c[l][t-1].value===u&&r.push(l+"_"+(t-1)),c[l][t+1].value===u&&r.push(l+"_"+(t+1)),c[l+1][t-1].value===u&&r.push(l+1+"_"+(t-1)),c[l+1][t].value===u&&r.push(l+1+"_"+t),c[l+1][t+1].value===u&&r.push(l+1+"_"+(t+1))):l===s?0===t?(c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l-1][t+1].value===u&&r.push(l-1+"_"+(t+1)),c[l][t+1].value===u&&r.push(l+"_"+(t+1))):t===s?(c[l-1][t-1].value===u&&r.push(l-1+"_"+(t-1)),c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l][t-1].value===u&&r.push(l+"_"+(t-1))):(c[l-1][t-1].value===u&&r.push(l-1+"_"+(t-1)),c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l-1][t+1].value===u&&r.push(l-1+"_"+(t+1)),c[l][t-1].value===u&&r.push(l+"_"+(t-1)),c[l][t+1].value===u&&r.push(l+"_"+(t+1))):0===t?(c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l-1][t+1].value===u&&r.push(l-1+"_"+(t+1)),c[l][t+1].value===u&&r.push(l+"_"+(t+1)),c[l+1][t].value===u&&r.push(l+1+"_"+t),c[l+1][t+1].value===u&&r.push(l+1+"_"+(t+1))):t===s?(c[l-1][t-1].value===u&&r.push(l-1+"_"+(t-1)),c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l][t-1].value===u&&r.push(l+"_"+(t-1)),c[l+1][t-1].value===u&&r.push(l+1+"_"+(t-1)),c[l+1][t].value===u&&r.push(l+1+"_"+t)):(c[l-1][t-1].value===u&&r.push(l-1+"_"+(t-1)),c[l-1][t].value===u&&r.push(l-1+"_"+t),c[l-1][t+1].value===u&&r.push(l-1+"_"+(t+1)),c[l][t-1].value===u&&r.push(l+"_"+(t-1)),c[l][t+1].value===u&&r.push(l+"_"+(t+1)),c[l+1][t-1].value===u&&r.push(l+1+"_"+(t-1)),c[l+1][t].value===u&&r.push(l+1+"_"+t),c[l+1][t+1].value===u&&r.push(l+1+"_"+(t+1))),r}function T(){return{value:0,visible:!1,flag:!1}}function D(e,a){var n=c[e][a],u=L(e,a);if(i)u.toggleClass("glyphicon glyphicon-flag btn-danger");else if("x"==n.value&&u.hasClass("glyphicon-flag"))u.css("background","green").unbind(),u.addClass("visible disabled");else switch(u.removeClass("glyphicon glyphicon-flag btn-danger"),u.addClass("visible disabled").text(n.value).unbind(),n.value){case"x":u.css("background","red");break;case 0:u.text("");break;case 1:u.css("color","black");break;case 2:u.css("color","green");break;case 3:u.css("color","red");break;case 4:u.css("color","blue");break;case 5:u.css("color","purple")}}function E(v){if(v.x){console.log("moduleEvt");var f=v.y,h=v.x}else{console.log("userClick");var d=function(e){var a=e.id.split("_");return{x:Number(a[1]),y:Number(a[0])}}(v.target);f=d.y,h=d.x}L(f,h);var _=c[f][h];2===v.button||i?_.flag?(_.flag=!1,p.text(++n),D(f,h),"x"===_.value&&u--):n>0&&(_.flag=!0,p.text(--n),D(f,h),"x"===_.value&&u++,u===a&&(I(),g())):_.flag||("x"==_.value?(k(),clearInterval(r),console.log("LOSE"),m.text("Das war eine Bombe!"),x.text("Du hast leider verloren!"),b.modal()):0==_.value?(function(e,a){!function(e){for(var a,u,l=new Array,t=new Array,s=0;s<e.length;s++){n((a=e[s].split("_"))[0],a[1]),l=O(l=(l=(l=(l=(l=M(a[0],a[1],1)).concat(M(a[0],a[1],2))).concat(M(a[0],a[1],3))).concat(M(a[0],a[1],4))).concat(M(a[0],a[1],5)),t),t=t.concat(l);for(var r=0;r<l.length;r++)n((u=l[r].split("_"))[0],u[1])}}(function(e){for(var a,n,u,l=e,t=e;t.length>0;){e=t,t=[];for(var s=0;s<e.length;s++)u=e[s].split("_"),a=M(u[0],u[1],0),n=O(a,t),t=t.concat(O(n,l));l=l.concat(t)}return l}([e+"_"+a]));function n(e,a){c[e][a].flag||c[e][a].visible||(D(e,a),c[e][a].visible=!0,l++)}}(f,h),s++):(c[f][h].visible=!0,D(f,h),l++,s++),l===100-a&&g());function g(){k(),clearInterval(r),console.log("WIN"),void 0===t||o<t?(t=o,w.text("Best Try: "+o+" seconds - "+s+" clicks"),m.text("Neuer Rekord!"),x.text(o+" seconds - "+s+" clicks"),b.modal()):(y.text("Last Try: "+o+" seconds - "+s+" clicks"),m.text("Gewonnen!"),x.text(o+" seconds - "+s+" clicks"),b.modal())}function k(){for(var a=0;a<e;a++)for(var n=0;n<e;n++)v.visible||D(a,n)}}function L(e,a){return _.find("#"+e+"_"+a)}function O(e,a){for(var n=[],u=!1,l=0;l<e.length;l++){for(var t=0;t<a.length;t++)if(e[l]===a[t]){u=!0;break}!1===u&&n.push(e[l]),u=!1}return n}return{start:A,click:function(e,a,n){E({y:e,x:a,button:n})}}};